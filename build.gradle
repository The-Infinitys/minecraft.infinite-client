plugins {
	id 'fabric-loom' version "${loom_version}"
	id 'maven-publish'
	id "org.jetbrains.kotlin.jvm" version "2.3.0-Beta2"
	id "org.jetbrains.kotlin.plugin.serialization" version "2.3.0-Beta2"
	id "com.diffplug.spotless" version "8.0.0"
}
apply plugin: "com.diffplug.spotless"
version = project.mod_version
group = project.maven_group

base {
	archivesName = project.archives_base_name
}

repositories {
	// Baritone (Meteor Development) ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ 
	maven {
		name = "meteor-maven-snapshots"
		url = uri("https://maven.meteordev.org/snapshots")
	}
	maven {
		name = 'babbaj-repo'
		url = 'https://babbaj.github.io/maven/'
	}
	// Add repositories to retrieve artifacts from in here.
	// You should only use this when depending on other mods because
	// Loom adds the essential maven repositories to download Minecraft and libraries from automatically.
	// See https://docs.gradle.org/current/userguide/declaring_repositories.html
	// for more information about repositories.
}

loom {
	splitEnvironmentSourceSets()
	accessWidenerPath = file("src/main/resources/infinite.accesswidener")
	SourceSet mainSourceSet = sourceSets.main
	SourceSet clientSourceSet = sourceSets.client
	mods {
		"infinite" {
			sourceSet(mainSourceSet)
			sourceSet(clientSourceSet)
		}
	}
}

fabricApi {
	configureDataGeneration {
		client = true
	}
}

dependencies {
	// To change the versions see the gradle.properties file
	minecraft "com.mojang:minecraft:${project.minecraft_version}"
	mappings "net.fabricmc:yarn:${project.yarn_mappings}:v2"
	modImplementation "net.fabricmc:fabric-loader:${project.loader_version}"

	// Fabric API. This is technically optional, but you probably want it anyway.
	modImplementation "net.fabricmc.fabric-api:fabric-api:${project.fabric_version}"
	modImplementation "net.fabricmc:fabric-language-kotlin:${project.fabric_kotlin_version}"
	implementation "org.jetbrains.kotlinx:kotlinx-serialization-json:1.9.0"

	implementation "dev.babbaj:nether-pathfinder:${project.nether_pathfinder_version}"
	modImplementation("meteordevelopment:baritone:${project.baritone_version}")
}

processResources {
	def modVersion = project.version
	inputs.property "version", modVersion

	filesMatching("fabric.mod.json") {
		// ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã§ã€ã‚¹ã‚³ãƒ¼ãƒ—ã®å•é¡Œã‚’å›é¿ã—ã€å®‰å…¨ã«å±•é–‹ã—ã¾ã™
		expand "version": modVersion
	}
}

java {
	// Loom will automatically attach sourcesJar to a RemapSourcesJar task and to the "build" task
	// if it is present.
	// If you remove this line, sources will not be generated.
	withSourcesJar()

	sourceCompatibility = JavaVersion.VERSION_21
	targetCompatibility = JavaVersion.VERSION_21
}

// ğŸ“Œ JVM Toolchainè¨­å®š: Java 21ã«çµ±ä¸€ (éæ¨å¥¨è­¦å‘Šã‚’å›é¿ã™ã‚‹ãŸã‚ã®ãƒ¢ãƒ€ãƒ³ãªæ–¹æ³•)
kotlin {
	jvmToolchain(21)
}
jar {
	inputs.property "archivesName", project.base.archivesName
	// splitEnvironmentSourceSetsã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«çµæœã‚’å¿…ãšå«ã‚ã‚‹
	from(sourceSets.client.output)

	// renameã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å†…ã§ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤ã‚’ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã«æ ¼ç´ã—ã¾ã™ã€‚
	def archiveName = project.base.archivesName

	from("LICENSE") {
		// Groovyã®å‹æ¨è«–ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ã€ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã®å¼•æ•°ã‚’æ˜ç¤ºçš„ã« fileName ã¨ã—ã€
		// ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•° archiveName ã‚’å‚ç…§ã—ã¾ã™ã€‚
		rename { fileName -> "${fileName}_${archiveName}" }
	}
}
// configure the maven publication
publishing {
	publications {
		// --- ğŸ“Œ ä¿®æ­£ç®‡æ‰€: ã“ã“ã‚’ã‚·ãƒ³ãƒ—ãƒ«ãªå®šç¾©ã«ä¿®æ­£ã—ã¾ã™ ---
		create("mavenJava", MavenPublication) {
			artifactId = project.archives_base_name
			// remapJarã¨remapSourcesJarã‚’æˆæœç‰©ã¨ã—ã¦è¿½åŠ 
			// remapSourcesJarã‚¿ã‚¹ã‚¯ã‚’ç›´æ¥å‚ç…§ã™ã‚‹ã ã‘ã§OK
			artifact remapJar
			artifact remapSourcesJar

			from components.java
			groupId project.group
			version project.version
		}
	}

	// GitHub Packagesãƒªãƒã‚¸ãƒˆãƒªã¸ã®å…¬é–‹è¨­å®š
	repositories {
		maven {
			name = "GitHubPackages"
			// GitHubãƒªãƒã‚¸ãƒˆãƒªã®URLã‚’è¨­å®š
			url = uri("https://maven.pkg.github.com/The-Infinitys/minecraft.infinite-client")
			credentials {
				// GitHub Actionsã§è‡ªå‹•çš„ã«æä¾›ã•ã‚Œã‚‹GITHUB_TOKENã‚’ä½¿ç”¨
				username = System.getenv("GITHUB_ACTOR") ?: "github"
				password = System.getenv("GITHUB_TOKEN") ?: "token"
			}
		}
	}
}

// Spotlessãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®š
spotless {
	// Javaã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¾ã™
	java {
		// ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å ´æ‰€ã‚’æŒ‡å®š
		target 'src/**/*.java'
		// Googleã®Javaãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
		googleJavaFormat()
		// å¿…è¦ã§ã‚ã‚Œã°ã€ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ãªã©ã‚‚ã“ã“ã«è¿½åŠ ã§ãã¾ã™
	}
	// Kotlinã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¾ã™
	kotlin {
		// ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å ´æ‰€ã‚’æŒ‡å®š
		target 'src/**/*.kt'
		// ktlintã‚’é©ç”¨ (ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã¯æ¨å¥¨ã•ã‚Œã‚‹ `ktlint()` é–¢æ•°å†…ã§)
		ktlint("1.7.1") // æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦æŒ‡å®šã—ã¦ãã ã•ã„
		// ktlintã®ã‚«ã‚¹ã‚¿ãƒ è¨­å®šãŒå¿…è¦ãªå ´åˆã¯ã€ã“ã“ã«è¿½åŠ ã§ãã¾ã™
	}
	// Gradleã‚¹ã‚¯ãƒªãƒ—ãƒˆè‡ªä½“ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¾ã™
	groovyGradle {
		target '**/build.gradle'
		greclipse()
	}

	// Kotlin/Gradleã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹å ´åˆ
	kotlinGradle {
		target '**/*.kts' // *.ktsãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆ
		ktlint()
	}
}
